---
title: "Logto SDK Integration and Authentication Setup"
epic: "ecosystem-net-platform-max"
status: "pending"
priority: "high"
assignee: "claude"
created_at: "2025-09-13T00:42:30Z"
updated_at: "2025-09-13T00:42:30Z"
depends_on: []
parallel: false
tags: ["authentication", "logto", "sdk", "integration"]
estimated_hours: 4
---

# Logto SDK Integration and Authentication Setup

## Overview
Set up Logto SDK for Next.js authentication with redirect-based flow, replacing any existing auth UI with proper redirect triggers and configuring callback handlers for authorization code processing.

## Objectives
- Install and configure @logto/next SDK
- Implement redirect-based authentication flow
- Set up callback handlers for authorization code processing
- Replace existing auth UI with redirect triggers
- Ensure port alignment between .env.local and dev server

## Tasks

### 1. Install Logto SDK
- [ ] Install @logto/next package via pnpm
- [ ] Verify compatibility with Next.js 15 and App Router
- [ ] Check for any peer dependency requirements

### 2. Environment Configuration
- [ ] Update .env.local with Logto configuration variables:
  - LOGTO_ENDPOINT
  - LOGTO_APP_ID
  - LOGTO_APP_SECRET
  - NEXT_PUBLIC_LOGTO_ENDPOINT
- [ ] Ensure port alignment (6789) between .env.local and dev server
- [ ] Set up redirect URIs for callback handling

### 3. Logto Provider Setup
- [ ] Create Logto configuration in app/layout.tsx or dedicated provider
- [ ] Configure LogtoProvider with appropriate settings
- [ ] Set up client configuration for App Router compatibility

### 4. Authentication Flow Implementation
- [ ] Implement redirect-based sign-in functionality
- [ ] Create callback handler at /api/logto/[...logto]/route.ts
- [ ] Set up sign-out redirect flow
- [ ] Configure session management

### 5. Replace Existing Auth UI
- [ ] Identify any existing custom login forms or auth components
- [ ] Replace with redirect triggers using Logto hooks
- [ ] Update navigation components to use Logto authentication state
- [ ] Remove any redundant authentication UI components

### 6. Route Protection
- [ ] Implement authentication guards for protected routes
- [ ] Set up middleware for route-level authentication checks
- [ ] Configure redirect behavior for unauthenticated users

### 7. Testing and Validation
- [ ] Test sign-in flow with redirect
- [ ] Verify callback handling works correctly
- [ ] Test sign-out functionality
- [ ] Validate session persistence across page refreshes
- [ ] Test authentication state in different components

## Acceptance Criteria
- [ ] @logto/next SDK is properly installed and configured
- [ ] Authentication uses redirect-based flow (no custom login forms)
- [ ] Callback handlers process authorization codes correctly
- [ ] Port configuration is aligned between .env.local (6789) and dev server
- [ ] All existing custom auth UI is replaced with redirect triggers
- [ ] Users can sign in, sign out, and maintain session state
- [ ] Protected routes properly redirect unauthenticated users

## Technical Notes
- Use Next.js App Router compatible patterns
- Follow Logto's official Next.js integration guide
- Ensure proper TypeScript typing for authentication state
- Consider implementing loading states during authentication flows
- Document any configuration changes in project documentation

## Dependencies
- Next.js 15 with App Router
- @logto/next SDK
- Logto tenant configuration (handled in task 002)

## Risks & Mitigations
- **Risk**: SDK compatibility issues with Next.js 15
  - **Mitigation**: Check official compatibility documentation and test thoroughly
- **Risk**: Port configuration conflicts
  - **Mitigation**: Carefully verify all configuration files and dev server settings
- **Risk**: Breaking existing functionality
  - **Mitigation**: Test all authentication flows and user journeys